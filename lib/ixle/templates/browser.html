{%extends "search.html"%}

{%block query_helo%}
<table width=100%>
  <tr><td>
      Browsing: {{_}}"<i><span id=dir_view_widget>{{query}}</span></i>"
    </td>
    <td align=right>
      {%include "widgets/fs_disconnect_notification.html"%}
      <small>
        <a href="javascript:post_to_api('indexer', {action:'indexer',_:'{{_}}'})"">index directory</a> |
        <a href="javascript:post_to_api('unindex')">unindex directory</a> |
        <a href="/rename?_={{_}}">rename dir recursively</a>
        <!--a href="/api?action=kill_directory&_={{query}}">kill directory</a-->
      </small>
    </td>
  </tr>
</table>
{%endblock%}

{% block body %}
<div id=block_body style="margin-left:10px;width:100%">
  {%if files%}
  <strong>Files:</strong> <small><i>(according to filesystem)</i></small>
  <div style="margin-left:15px;">
    {%for short_name, apath in files.items()%}
    <small>
      <a href="javascript:show_detail({{apath|escapejs}})">{{short_name}}</a>
    </small>
    <strong>|</strong>
    {%endfor%}
  </div>
  <hr/>
  {%endif%}
  {%if subddirs%}
  <strong>Subdirs::</strong>
  <div style="margin-left:15px;">
    {%for name,fullpath in subddirs%}
    <small>
      <a href="/browser?_={{fullpath}}">{{name}}</a>
    </small>
    <strong>|</strong>
    {%endfor%}
  </div>
  <hr/>
  {%endif%}
</div>
{{super()}}
{%endblock%}

{%block footer_left%}
{% import 'ixle_macros.html' as macros %}
<script type="text/javascript">anylinkmenu.init("menuanchorclass")</script>


<script>
  var run_agent_types = [];
  var frun_agent_types = [];
  {%for agent in agent_types%}
  run_agent_types.push(['{{agent}}',"/spawn?agent={{agent}}&path={{query}}"]);
  frun_agent_types.push(['{{agent}}',"/spawn?force=1&agent={{agent}}&path={{query}}"]);
  {%endfor%}
</script>
<table>
  <tr>
    <td>
      {%with uuid='run_agent_types', list_name='run_agent_types', name='apply agent'%}
      {{macros.anylink(name,list_name,uuid)}}
      {%endwith%}
    </td>
    <td>|
    </td>
    <td>
      {%with uuid='frun_agent_types', list_name='frun_agent_types', name='force-apply agent'%}
      {{macros.anylink(name,list_name,uuid)}}
      {%endwith%}
    </td>
  <tr>
</table>

<script>
  {%with abspath=query%}{%include "javascript/dir_view_widget.js"%}{%endwith%}
  {%include "javascript/show_detail.js"%}
  {%include "javascript/post_to_api.js" %}
</script>
{%endblock%}
