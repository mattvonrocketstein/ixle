{%extends "search.html"%}

{%block query_helo%}
<table width=100%>
  <tr><td>
      Browsing: "<i><span id=dir_view_widget>{{query}}</span></i>"
    </td>
    <td align=right>
      <span id=disconnection_notification>
        <script>
          $(document).ready(function(){$('#disconnection_notification').load('/widgets/is_available',{'_':'{{query}}'})});
        </script>
      </span>
      <small>
        <a href=#>index directory</a> |
        <a href=#>unindex directory</a> |
        <a href=#>rename recursively</a>
        <!--a href="/api?action=kill_directory&_={{query}}">kill directory</a-->
      </small>
    </td>
  </tr>
</table>
{%endblock%}

{% block body %}
<div style="width:100%">
  {%if files%}
  <strong>Files:</strong> <small><i>(according to filesystem)</i></small>
  <div style="margin-left:15px;">
       {%for short_name, apath in files.items()%}
       <small>
         <a href="javascript:show_detail({{apath|escapejs}})">{{short_name}}</a>
       </small>
       <strong>|</strong>
       {%endfor%}
  </div>
  <hr/>
  {%endif%}
  {%if subddirs%}
  <strong>Subdirs::</strong>
  <div style="margin-left:15px;">
       {%for name,fullpath in subddirs%}
       <small>
         <a href="/browser?_={{fullpath}}">{{name}}</a>
       </small>
       <strong>|</strong>
       {%endfor%}
  </div>
  <hr/>
{%endif%}
</div>
{{super()}}
{%endblock%}

{%block footer_left%}

<table>
  <tr>
    <td><strong>run:</strong></td>
    <td>
      {%for agent in agent_types%}
      <a href="/spawn?agent={{agent}}&path={{query}}">{{agent}}</a>
      <strong>|</strong>
      {%endfor%}
    </td>
  <tr>
  <tr>
    <td><strong>force-run:</strong></td>
    <td>
      {%for agent in agent_types%}
      <a href="/spawn?force=1&agent={{agent}}&path={{query}}">{{agent}}</a>
      <strong>|</strong>{%endfor%}
    </td>
  <tr>
</table>

<script>
  {%with abspath=query%}{%include "javascript/dir_view_widget.js"%}{%endwith%}
  {%include "javascript/show_detail.js"%}
</script>
{%endblock%}
